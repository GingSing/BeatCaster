<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>BeatCaster</title>

    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-haptics-component/dist/aframe-haptics-component.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
  </head>

  <body>
    <script src="beatMap.js"></script>
    <script>
      const socket = io();
      const leaderBoardObj = document.getElementById("leaderBoard");
      socket.on("selectSong", details => {
        // leaderBoardObj.setAttribute("leaderboard", { initialLeaderBoard });
        leaderBoard = details.scores;
        gameState.user_id = details.user_id;
        // on every note send data through socket
        // if number greater than whats on list replace and push down
        // save to database afterwards
      });

      socket.on("update", newLeaderBoardValue => {
        let updated = false;
        for (let i in leaderBoard) {
          if (leaderBoard[i].user_id === newLeaderBoardValue.user_id) {
            leaderBoard[i] = newLeaderBoardValue;
            updated = true;
          }
        }

        if (!updated) {
          let nextValue;
          for (let i = 0; i < 5; i++) {
            if (
              !nextValue &&
              leaderBoard[i].score < newLeaderBoardValue.score
            ) {
              nextValue = { ...leaderBoard[i] };
              leaderBoard[i] = newLeaderBoardValue;
            } else if (nextValue) {
              let tempValue = { ...leaderBoard[i] };
              leaderBoard[i] = nextValue;
              nextValue = tempValue;
            }
          }
        }
      });
    </script>
    <script src="scripts/gameState.js"></script>
    <script src="scripts/constants.js"></script>
    <script src="scripts/components/generator.js"></script>
    <script src="scripts/components/disappearOnClick.js"></script>
    <script src="scripts/components/setClickable.js"></script>
    <script src="scripts/components/shrink.js"></script>
    <script src="scripts/components/givePoints.js"></script>
    <script src="scripts/components/drawLinesBetween.js"></script>
    <script src="scripts/components/showBeam.js"></script>
    <script src="scripts/components/showScore.js"></script>
    <script src="scripts/components/startmenu.js"></script>
    <script src="scripts/components/songPlayer.js"></script>
    <script src="scripts/components/pause.js"></script>
    <script src="scripts/components/play.js"></script>
    <script src="scripts/components/increaseBeatNumOnRemove.js"></script>
    <script src="scripts/components/chargeBeam.js"></script>
    <script src="scripts/components/Feedback/generateBeam.js"></script>
    <script src="scripts/components/Feedback/removeBeam.js"></script>
    <script src="scripts/components/Feedback/reverseShrink.js"></script>
    <script src="scripts/components/spawnReverse.js"></script>
    <script src="scripts/components/removeSelfTimer.js"></script>
    <script src="scripts/components/scaleOnHover.js"></script>
    <script src="scripts/components/songUI.js"></script>
    <script src="scripts/components/selectSong.js"></script>
    <!-- Makes mouse trackable put in a-scene
      raycaster="objects: .clickable"
      cursor="rayOrigin: mouse" -->

    <a-scene
      generator
      setclickable
      drawlinesbetween
      raycaster="objects: .clickable"
      cursor="rayOrigin: mouse"
    >
      <a-assets>
        <img id="ring" src="ringWhite.png" />
        <a-mixin
          scaleonhover
          selectsong
          id="selection"
          class="clickable"
          geometry="primitive: plane; width: 2;  height: .4 "
          material="color: white"
        ></a-mixin>
        <a-mixin
          id="sizeimg"
          geometry="width: 0.2; height: 0.2"
          position="-.75 0 0"
        ></a-mixin>
      </a-assets>

      <!--The pause button-->
      <a-plane
        scaleonhover
        pause
        id="pauseBtn"
        class="clickable"
        height="0.3"
        width="0.8"
        color="grey"
        position="-1 1 -3"
      >
        <a-text value="Pause" align="center"></a-text>
      </a-plane>

      <!--Main menu-->
      <a-plane
        id="start"
        songui
        width="3"
        height="2"
        color="grey"
        position="0 1.4 -2.5"
      >
        <!-- used for Song containers -->
        <a-entity mixin="selection" class="clickable" position="0 .5 .1">
          <a-image songui mixin="sizeimg"></a-image>
          <a-text songui align="center" scale=".5 .5 1"></a-text>
        </a-entity>

        <a-entity mixin="selection" class="clickable" position="0 0 .1">
        </a-entity>

        <a-entity
          mixin="selection"
          class="clickable"
          position="0 -.5 0.1"
        ></a-entity>
      </a-plane>

      <!-- old play button -->
      <a-plane
        id="playBtn"
        class="clickable"
        width="1"
        height=".5"
        color="grey"
        position="2 1 -2"
      >
        <!-- The Play button-->
        <a-text value="Play" align="center"></a-text>
      </a-plane>

      <!--Leaderboard-->
      <a-plane leaderboard></a-plane>

      <a-entity environment="preset: starry; dressingAmount: 400"></a-entity>

      <a-sound id="player" songplayer src="src: url(lightitup.mp3)"></a-sound>
      <a-text
        play
        id="score-element"
        showscore
        position="-0.35 0.5 -3"
      ></a-text>

      <!--Tracking for the vive controllers-->
      <a-entity
        id="rightHand"
        chargebeam
        laser-controls="hand: right"
        haptics="events: triggerdown; dur: 50; force: 0.2"
        raycaster="objects: .clickable; far: 50"
        line="color: red; opacity: 0.75"
        position="0 -0.9 0"
        rotation="90 0 0"
      >
      </a-entity>

      <a-entity
        id="leftHand"
        laser-controls="hand: left"
        haptics="events: triggerdown; dur: 50; force: 0.2"
        raycaster="objects: .clickable; far: 50"
        line="color: red; opacity: 0.75"
        position="0 -0.9 0"
        rotation="90 0 0"
      >
      </a-entity>
    </a-scene>
  </body>
</html>
